<?php

/**
 * @file
 * Module that displays a table of characters with their data
 * for the current logged in account.
 */
/*
 * Implementation of hook_views_api()
 */

function fructmodule_views_api() {
  return array('api' => 3.0);
}

/*
 * Implements hook_views_data_alter.
 */

function fructmodule_views_data_alter(&$data) {

  $data['fruct']['table']['group'] = t('Fruct');   // Advertise this table as a possible base table 
  $data['fruct']['table']['base'] = array(
    'field' => 'id',
    'title' => t('Fruct'),
    'weight' => -10,
    'access query tag' => 'node_access',
    'database' => 'testdb2',
    'defaults' => array(
      'field' => 'fruct',
    ),
  );
//
//  echo "<pre>";
//  print_r($data['fruct']);
//  die();
////// For other base tables, explain how we join 
  $data['fructe']['table']['join'] = array(
    // this explains how the 'node' table (named in the line above) 
    // links toward the node_revision table.
//    'database' => 'testdb1',

    'fruct' => array(
      'database' => 'testdb1',
      'left_table' => 'testdb1.fruct',
      'left_field' => 'tip_fruct',
      'field' => 'tip',
    ),
    
    
  );

//  $data ['fructe']['table']['default_relationship'] = array(
//    'fruct' => array(
//      'database' => 'testdb1',
//      'table' => 'fruct',
//      'field' => 'id',
//    ),
//  );
//
//
//  dpm($data['fructe']);
}


function fructmodule_views_query_alter(&$view, &$query) {
//  dpm($view);
//  dpm($query);
    $join = new views_join();
    $join->table = 'testdb1.fructe';
    $join->field = 'id';
    $join->left_table = 'fruct';
    $join->left_field = 'tip_fruct';
    $join->type = 'left';
//    $join->extra = array(
//        array(
//            'field' => 'bundle',
//            'value' => 'user',
//        )
//    );
    $query->add_relationship('fructe', $join, 'node');
  
    dpm($query);
    dpm($join);
}
?>